apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
  namespace: redis
data:
  # Master 配置
  master.conf: |
    bind 0.0.0.0
    port 6379
    requirepass redis123
    masterauth redis123
    
    # 持久化配置
    appendonly yes
    appendfsync everysec
    
    # 内存配置
    maxmemory 256mb
    maxmemory-policy allkeys-lru
    
    # 日志
    loglevel notice
  
  # Replica 配置
  replica.conf: |
    bind 0.0.0.0
    port 6379
    requirepass redis123
    masterauth redis123
    
    # 从 Master 复制
    replicaof redis-master 6379
    replica-read-only yes
    
    # 持久化
    appendonly yes
    appendfsync everysec
    
    # 内存
    maxmemory 256mb
    maxmemory-policy allkeys-lru
  
  # Sentinel 配置
  sentinel.conf: |
    port 26379
    sentinel monitor mymaster redis-master 6379 2
    sentinel auth-pass mymaster redis123
    sentinel down-after-milliseconds mymaster 5000
    sentinel failover-timeout mymaster 60000
    sentinel parallel-syncs mymaster 1
---
apiVersion: v1
kind: Secret
metadata:
  name: redis-secret
  namespace: redis
type: Opaque
stringData:
  redis-password: redis123
